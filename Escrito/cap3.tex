\chapter{BASE TEÓRICA}

En este capítulo se presentará una introducción teórica de la herramienta de neuroevolución HyperNEAT y sus componentes, necesaria para la implementación de \(\tau\)-HyperNEAT.

\section{COMPOSITIONAL PATTERN PRODUCING NETWORKS (CPPNs)}

Un concepto base en la codificación en la naturaleza es que un pequeño número de genes pueden codificar un gran número de subestructuras dentro de un fenotipo a través de la reutilización de genes. En biología, los genes en el AND representan estructuras extremadamente complejas con miles de millones de partes interconectadas. Sin embargo el ADN no posee miles de millones de genes, sino que de algún modo solo 30 mil genes codifican todo el cuerpo humano.

La reutilización de genes se hace posible debido a que una estructura o fenotipo puede poseer un gran número de patrones, y estos patrones un sin número de regularidades, tal como ocurre en la naturaleza. De no existir regularidades no se hace posible reproducir distintas partes de una estructura a partir de la misma información, perdiendo gran ventaja en la codificación. 

En el siguiente sección se introducirán importantes características del desarrollo de patrones.

\subsection{DESARROLLO DE PATRONES}

Identificar las características generales de los patrones presentes en la naturaleza es un prerrequisito importante para describir como esos patrones pueden ser generados algorítmicamente. A continuación se mencionarán características generales de patrones observados en organismos de la naturaleza que también puede buscarse en fenotipos evolucionado artificialmente.

\begin{itemize}
\item \textbf{Repetición } Múltiples instancias de la misma subestructura es un sello distintivo de los organismos biológicos. Desde las células de todo el cuerpo hasta las neuronas del cerebro, las mismas estructuras se repiten una y otra vez en un único organismo. La repetición en el fenotipo también se llama auto similitud.
\item \textbf{Repetición con variaciones } Frecuentemente estructuras se encuentran repetidas pero no de forma completamente idénticas. Esto se ve de forma frecuente en toda la naturaleza, como por ejemplo en las vertebras de una columna o en los mismos dedos de una mano, cada una de sus componentes posee la misma estructura pero con distintas variaciones.
\item \textbf{Simetría } A menudo las repeticiones ocurren a través de las simetrías, como cuando los lados derecho e izquierdo del cuerpo son idénticas, produciéndose una simetría bilateral.
\item \textbf{Simetría imperfecta } Mientras que un tema simétrico general es observable en muchas estructuras biológicas, muchas veces no son perfectamente simétricas. Tal simetría imperfecta es una característica común de repetición con variaciones. El cuerpo humano es simétrico en general, pero no es equitativo en ambos lados; algunos órganos solo aparecen en uno de los lados, y un lado es generalmente dominante sobre el otro.
\item \textbf{Regularidades elaboradas } Durante muchas generaciones, regularidades son a menudo elaboradas y mucho mas explotadas, como por ejemplo las aletas de los peces con simetría bilateral temprana que con el tiempo se convirtieron en los brazos y manos de mamíferos.
\item \textbf{Preservación de regularidades } Durante generaciones, determinadas regularidades son estrictamente preservadas. Simetrías bilaterales no producen fácilmente simetrías de tres vías, y animales cuadrúpedos raramente producen crías con distinto numero de extremidades.
\end{itemize}

Usando esta lista, fenotipos y linajes producidos por codificaciones artificiales pueden ser analizados en base a características presentes naturalmente, dando una indicación de si una codificación particular esta capturando propiedades y capacidades esenciales de un desarrollo natural.

La siguiente sección describe un proceso mediante el cual los patrones representados por un conjunto de genes pueden llegar a ser cada vez más complejos.

\subsection{COMPLEJIFICACIÓN}

EL proceso de complejificación permite a la evolución descubrir fenotipos más complejos de los que sería posible descubrir a través de la optimización de un conjunto fijo de genes. 

En la búsqueda de la solución a un problema particular, cuya dimensión es desconocida a priori, mientras más dimensiones tenga el espacio de solución seleccionado, más difícil se hace descubrir esta solución. En otras palabras, soluciones más complejas son más difíciles de evolucionar que otras mas simples. Es por esto que se busca reducir la complejidad del espacio de búsqueda mediante la codificación de un fenotipo complejo en un genotipo de dimensiones significativamente menores.

La razón de por qué la evolución puede superar el problema de la complejidad es que no se inicia la búsqueda en un espacio de la misma complejidad que la solución final. Nuevos genes son ocasionalmente añadidos al genoma, permitiendo a la evolución complejizar funciones por sobre el proceso de optimización. La complejificación permite a la evolución comenzar con fenotipos simples partiendo por un espacio de búsqueda dimensionalmente más pequeño para trabajar sobre este de manera incremental, opuesto a la idea de trabajar directamente a partir de sistemas más elaborados desde el comienzo.

Nuevos genes comúnmente aparecen a través de duplicación de otros genes, que es un tipo especial de mutación en donde uno o más genes de los padres son copiados en un genoma hijo más de una vez. El principal efecto de la duplicación de genes es el incremento de la dimensionalidad del genotipo, con lo que se podrán representar patrones fenotípicos cada vez más complejos. Por lo tanto, complejización y la codificación con reutilización de genes trabajan conjuntos para producir fenotipos complejos.

\subsection{MÉTODO DE CODIFICACIÓN}

``Compositional Pattern Producing Networks'' (CPPNs) es un método de codificación que permite describir directamente relaciones estructurales de una topología a través de una composición de 		funciones. 

Con el fin de poder codificar un fenotipo determinado es que ayuda concebirlo como una distribución de puntos en un espacio cartesiano multidimensional. Visto de esta manera, un fenotipo puede ser descrito como una función de dimension \textit{n}, donde \textit{n} es el número de dimensiones en el mundo físico. Para cada coordenada, la presencia o ausencia de un punto es una salida de la función que define el fenotipo. La figura \ref{mapfenotipo} muestra como un fenotipo bidimensional puede ser generado a través de una función de dos parámetros

\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{fig/mapfenotipo.png}
\caption{\textbf{Una función produce un fenotipo. } La funcion \textit{f} toma los argumentos \textit{x} e \textit{y}, las cuales son coordenadas en un espacio bidimensional. Cuando todas las coordenadas son dibujadas con una intensidad correspondiente a la salida de la función \textit{f}, el resultado es un patrón, el cual puede ser visto como un fenotipo cuyo genotipo es \textit{f}. En este ejemplo, \textit{f} produce un fenotipo triangular.}
\label{mapfenotipo}
\end{figure}

Una manera natural de representar una composición de funciones es a través de un grafo de funciones interconectadas, como se muestra en la figura \ref{grafo}. Es así como el sistema de coordenadas inicial de una estructura puede ser provisto como entrada del grafo. El siguiente nivel de nodos puede ser visto como una descripción inicial del primer sistema de coordenadas de dicha estructura. Niveles mas elevados de nodos establecerán sistemas de coordenadas cada vez más refinados. Finalmente las salidas finales corresponden a las transformaciones de todas las capas anteriores, entregando una codificación del sistema de coordenadas provisto.

\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{fig/grafo.png}
\caption{\textbf{Composición de funciones en forma de grafo. } El grafo determina cual función esta conectada con cual. A cada conexión se le asigna un peso, el cual multiplica a la salida de la función del nodo entrante. Si múltiples conexiones entran a una misma función, esta recibe como entrada la suma de las salidas de cada una de las funciones entrantes multiplicadas por sus respectivos pesos de conexión. Se debe tener en cuenta que la topología no tiene restricciones y puede representar cualquier relación posible. Esta representación es similar al formalismo de las ANNs tradicionales con funciones de activación y topologías arbitrarias.}
\label{grafo}
\end{figure}

Es interesante observar que un grafo de dicha composición es muy similar a una ANN con topología arbitraria. La única diferencia entre ambas es que las ANNs generalmente usan funciones sigmoides (y a veces funciones Gaussianas) como función de activación de cada nodo, mientras que un grafo puede usar cualquier variedad de funciones canónicas en cada nodo.

Finalmente podemos referirnos a ``Compositional Pattern Producing Networks'' (CPPNs) para describir a una composición de funciones en forma de grafo que busca reproducir patrones regulares.

\subsection{EVOLUCIONANDO CPPNs}

Casualmente CPPNs y ANNs son prácticamente lo mismo desde una perspectiva estructural. Muchos métodos para evolucionar topologías y pesos de conexión en ANNs ya existen, por lo que es posible extender de manera fácil estos métodos para evolucionar CPPNs añadiendo pequeños cambios. También hay métodos para evolucionar programas genéticos, los cuales pueden ser muy similares a CPPNs.

Anteriormente se describió una propiedad esencial de la evolución en la naturaleza que describe la gradual complejificación del genoma. La idea principal es iniciar con un pequeño genoma al cual se le añaden nuevos genes en el trascurso de la evolución. En CPPNs esto significa que se añadirán nuevas conexiones o nodos de funciones a la red, permitiendo así complejificar la red para poder establecer regularidades fundamentales en los principios de su desarrollo para luego hacerlas más elaboradas a lo largo de la evolución.

El método a usar para evolucionar las CPPNs será ``NeuroEvolution of Augmenting Topologies'' (NEAT). NEAT es capaz de evolucionar ANNs increíblemente complejas a lo largo de generaciones, y sobrellevar los desafíos que conlleva evolucionar una gran población de redes de diversas topologías mediante el uso de marcas históricas. Ya que NEAT comienza trabajando sobre redes pequeñas y solo expande su espacio de solución cuando logra un beneficio de esta expansión, se vuelve capaz de encontrar ANNs significativamente mas complejas, de forma contraria a métodos que evolucionan topologías fijas.

A pesar de que NEAT originalmente fue diseñado para evolucionar ANNs, solo se requiere de pequeñas modificaciones para evolucionar CPPNs, ya que como se mencionó, estas son muy similares.

\section{CPPN-NEAT}

Esta sección explica cómo NEAT puede evolucionar CPPNs.

Mientras que anteriores métodos propuestos para evolucionar ANNs (métodos de neuroevolución) con topologías fijas o generadas arbitrariamente de forma aleatoria; NEAT es la primera que inicia la evolución a partir de una población de pequeñas y simples redes neuronales, aumentando su complejidad a lo largo de las generaciones, destacando un comportamiento cada vez más sofisticado.

Antes de describir como extender el algoritmo NEAT para evolucionar CPPNs es necesario describir las tres ideas principales de las cuales NEAT se basa. Primero, con el fin de permitir que las estructuras de las redes se complejifiquen a través de las generaciones se hace necesario un método para realizar un seguimiento de qué gen es cuál. De otra forma no es claro en posteriores generaciones cual individuo es compatible con cual, o como estos genes pueden ser combinados para producir genes hijos. NEAT soluciona este problema asignando una marca histórica única a cada nueva pieza de la estructura de la red que aparezca a través de mutaciones estructurales. La marca histórica es un número asignado a cada gen correspondiente a su orden de aparición durante el curso de la evolución. Estos números son heredados durante el entrecruzamiento sin cambios, y permitiendo a NEAT realizar entrecruzamientos de genes sin la necesidad de un costoso análisis topológico. De esta forma, genomas con diferentes estructuras o tamaños mantienen la compatibilidad a lo largo de la evolución, solucionando el problema planteado anteriormente de comparación de diferentes topologías en una población en evolución.

Segundo, NEAT separa en especies a los individuos de una población, por lo que los organismos compiten principalmente dentro de sus propios nichos en lugar de con toda la población. De esta manera las innovaciones topológicas en los genes son protegidas y se les da tiempo para que optimicen sus estructuras antes de competir con otros nichos dentro de la población. NEAT utiliza las marcas históricas en genes para determinar a qué especies pertenecen diferentes individuos.

Tercero, otros sistemas que evolucionan redes con topologías con nodos interconectados con pesos o costos en sus conexiones comienzan una evolución con una población con topologías aleatorias.  NEAT al contrario, comienza con una población uniforme de redes simples sin capas intermedias, difiriendo solo en los pesos de sus conexiones inicializados aleatoriamente. Diversas topologías se acumulan gradualmente durante la evolución, lo que permite diversos y complejos patrones fenotípicos para ser representados. No esta indicado un límite del tamaño que puede llegar a alcanzar una topología. Así, NEAT puede iniciar la evolución desde una estructura mínima, y aumentar el tamaño de la estructura sobre un número determinado de generaciones.

Nuevas estructuras son introducidas como ocurrencias de mutaciones estructurales, y solo sobrevivirán si es que resultan ser beneficiosas a través del cálculo de su desempeño. De este modo, otra ventaja de la complejificación es que NEAT busca a través de las soluciones dimensionalmente mas pequeñas, reduciendo significativamente el número de generaciones necesarias para encontrar la solución, y asegurando que la red no se volverá mas compleja de lo necesario. En efecto, entonces, NEAT realiza una búsqueda de una solución compacta y apropiada a través del incremento de la complejidad de estructuras ya existentes.

CPPN-NEAT es una extensión de NEAT que permite evolucionar CPPNs. Mientras que redes en el método NEAT original solo incluían nodos intermedios con funciones de activación sigmoides, los nodos en CPPN-NEAT son creados asignándoles aleatoriamente una función de activación proveniente de un grupo canónico determinado de funciones (por ejemplo incluyendo la función Gausiana, Sigmoide, y funciones periódicas). Además se define la función de distancia de compatibilidad para determinar si dos redes pertenecen a la misma especie, la cual incluye la información de por cuantas funciones de activación difieren dos individuos distintos. Esta característica permite que la separación de los individuos en especies tome en cuenta el número de funciones de activación que difieren entre individuos. Ya que CPPN-NEAT es una mejora de un preexistente efectivo método de neuroevolución, proporciona una base fiable para el estudio de la evolución de formas cada vez mas complejas. 