\chapter{BASE TEÓRICA}

En este capítulo se presentará una introducción teórica de la herramienta de neuroevolución HyperNEAT y sus componentes, necesario para la implementación de \(\tau\)-HyperNEAT.

\section{COMPOSITIONAL PATTERN PRODUCING NETWORKS (CPPNs)}

La representación forma parte fundamental del campo de la inteligencia artificial\cite{cppn}. En biología, los genes en el ADN representan estructuras extremadamente complejas con miles de millones de partes interconectadas. Sin embargo el ADN no posee miles de millones de genes, sino que de algún modo solo 30 mil genes representan o codifican todo el cuerpo humano.

La reutilización de genes se hace posible debido a que una estructura o fenotipo puede poseer un gran número de patrones, y estos patrones un sin número de regularidades, tal como ocurre en la naturaleza. De no existir regularidades no se hace posible reproducir distintas partes de una estructura a partir de la misma información, perdiendo gran ventaja en la codificación. 

En el siguiente sección se introducirán importantes características del desarrollo de patrones estructurales.

\subsection{DESARROLLO DE PATRONES}

Identificar las características generales de los patrones presentes en la naturaleza es un prerrequisito importante para describir como esos patrones pueden ser generados algorítmicamente. A continuación se mencionarán características generales de patrones observados en organismos de la naturaleza que también pueden ser observados en fenotipos evolucionados artificialmente.

\begin{itemize}
\item \textbf{Repetición } Múltiples instancias de la misma subestructura es un sello distintivo de los organismos biológicos. Desde las células de todo el cuerpo hasta las neuronas del cerebro, las mismas estructuras se repiten una y otra vez en un único organismo. 
\item \textbf{Repetición con variaciones } Frecuentemente estructuras se encuentran repetidas pero no de forma completamente idéntica. Esto se ve de forma frecuente en toda la naturaleza, como por ejemplo en las vertebras de una columna o en los mismos dedos de una mano, cada una de sus componentes posee la misma estructura pero con distintas variaciones.
\item \textbf{Simetría } A menudo las repeticiones ocurren a través de las simetrías, como cuando los lados derecho e izquierdo del cuerpo son idénticos, produciéndose una simetría bilateral.
\item \textbf{Simetría imperfecta } Mientras que un tema simétrico general es observable en muchas estructuras biológicas, muchas veces no son perfectamente simétricas. Tal simetría imperfecta es una característica común de repetición con variaciones. El cuerpo humano es simétrico en general, pero no es equitativo en ambos lados; algunos órganos solo aparecen en uno de los lados, y un lado es generalmente dominante sobre el otro.
\item \textbf{Regularidades elaboradas } Durante muchas generaciones, regularidades son a menudo elaboradas y mucho mas explotadas, como por ejemplo las aletas de los peces con simetría bilateral temprana que con el tiempo se convirtieron en los brazos y manos de mamíferos.
\item \textbf{Preservación de regularidades } Durante generaciones, determinadas regularidades son estrictamente preservadas. Simetrías bilaterales no producen fácilmente simetrías de tres vías, y animales cuadrúpedos raramente producen crías con distinto numero de extremidades.
\end{itemize}

Usando esta lista, fenotipos y linajes producidos por codificaciones artificiales pueden ser analizados en base a características presentes naturalmente, dando una indicación de si una codificación particular esta capturando propiedades y capacidades esenciales de un desarrollo natural.

La siguiente sección describe un proceso mediante el cual los patrones representados por un conjunto de genes pueden llegar a ser cada vez más complejos.

\subsection{COMPLEJIZACIÓN}

El proceso de complejización permite a la evolución descubrir fenotipos más complejos de los que sería posible descubrir a través de la optimización de un conjunto fijo de genes. 

En la búsqueda de la solución a un problema particular, cuya dimensión es desconocida a priori, mientras más dimensiones tenga el espacio de solución seleccionado, más difícil se hace descubrir esta solución. En otras palabras, soluciones más complejas son más difíciles de evolucionar que otras más simples. Es por esto que se busca reducir la complejidad del espacio de búsqueda mediante la codificación de un fenotipo complejo en un genotipo de dimensiones significativamente menores.

La clave para que la evolución pueda superar el problema de la complejidad es que no se inicia la búsqueda en un espacio de la misma complejidad que la solución final. Nuevos genes son ocasionalmente añadidos al genoma, permitiendo a la evolución complejizar funciones por sobre el proceso de optimización. La complejización permite a la evolución comenzar con fenotipos simples partiendo por un espacio de búsqueda dimensionalmente más pequeño para trabajar sobre éste de manera incremental, opuesto a la idea de trabajar directamente a partir de sistemas más elaborados desde el comienzo.

Nuevos genes comúnmente aparecen a través de duplicación de otros genes, que es un tipo especial de mutación en donde uno o más genes de los padres son copiados en un genoma hijo más de una vez. El principal efecto de la duplicación de genes es el incremento de la dimensionalidad del genotipo, con lo que se podrán representar patrones fenotípicos cada vez más complejos. Por lo tanto, complejización y la codificación con reutilización de genes trabajan conjuntos para producir fenotipos complejos.

\subsection{MÉTODO DE CODIFICACIÓN}

Con el fin de poder codificar un fenotipo determinado, es de ayuda concebirlo como una distribución de puntos a lo largo de un espacio cartesiano multidimensional. Visto de esta manera, un fenotipo puede ser descrito como una función $f: \mathbb{R}^{n}\longrightarrow\mathbb{R}$, donde $n$ es el número de dimensiones en el mundo físico. Para cada coordenada, la presencia o ausencia de un punto es una salida de la función que define el fenotipo. La figura \ref{mapfenotipo} muestra como un fenotipo bidimensional puede ser generado a través de una función de dos parámetros

\begin{figure}[t]
\centering
\includegraphics[width=0.8\textwidth]{fig/mapfenotipo.png}
\caption{\textbf{Una función produce un fenotipo. } La función \textit{f} toma los argumentos \textit{x} e \textit{y}, las cuales son coordenadas en un espacio bidimensional. Cuando todas las coordenadas son dibujadas con una intensidad correspondiente a la salida de la función \textit{f}, el resultado es un patrón, el cual puede ser visto como un fenotipo cuyo genotipo es \textit{f}. En este ejemplo, \textit{f} produce un fenotipo triangular. Imagen adaptada de \cite{cppn}.}
\label{mapfenotipo}
\end{figure}

Considere una distribución de puntos o marco de coordenadas en un eje cartesiano de izquierda a derecha, donde la concentración de puntos aumenta hacia la derecha. Las coordenadas de estos puntos a lo largo del eje podrían estar definidas simplemente por una función $f(x)=x$. Si consideramos una distribución de puntos en donde estos estuvieran concentrados hacia el punto medio entre ambos extremos y que disminuyen su concentración a medida que se acercan a los extremos, tal como se presentaría una simetría bilateral, esta podría ser descrita simplemente como una función Gaussiana $g(x) = \dfrac{1}{\sigma \sqrt{2\pi}}e^{-(x-\mu)^{2}/2 \sigma^{2}}$. Si se quisiera representar segmentación, podría hacerse a través de funciones periódicas. La función $h(x) = sin(x)$ podría representar puntos repetidos de forma equidistante a lo largo de un eje de coordenadas.

Diferentes marcos de coordenadas podrían interactuar en el proceso de desarrollo para producir patrones con regularidades mas complejas. Del mismo modo, marcos representados por funciones pueden interactuar y componer regularidades complejas. Por ejemplo, una simetría bilateral con segmentación a lo largo de un eje de coordenadas de izquierda a derecha puede producir dos grupos de segmentos con polaridades opuestas. Esta distribución podría ser representada fácilmente poniendo como entrada de una función periódica la salida de una función simétrica, realizando una composición de funciones, como se muestra en la figura \ref{compfunciones}. Así también, una serie de composiciones de funciones pueden unirse para formar una nueva composición de manera de producir marcos de coordenadas mas elaborados.

\begin{figure}[t]
\centering
\includegraphics[width=0.8\textwidth]{fig/compfunciones.png}
\caption{\textbf{Composición de funciones. } Este ejemplo ilustra como una simple composición de funciones en una dimensión puede producir patrones con múltiples regularidades. Una representación en forma de red de cada composición es mostrada a la derecha de los gráficos de cada función. La entrada asimétrica inicial $x$ a la entrada de una composición de una función simétrica ($F_{1}$) y una función periódica ($F_{2}$) produce dos grupos de segmentos con polaridades opuestas. Imagen adaptada de \cite{cppn}.}
\label{compfunciones}
\end{figure}

``Compositional Pattern Producing Networks'' (CPPNs) es un método de codificación que permite describir directamente relaciones estructurales de una topología a través de una composición de 		funciones. 

Una manera natural de representar una composición de funciones es a través de un grafo de funciones interconectadas, como se muestra en la figura \ref{grafo}. Es así como el sistema de coordenadas inicial de una estructura puede ser provisto como entrada del grafo. El siguiente nivel de nodos puede ser visto como una descripción inicial del primer sistema de coordenadas de dicha estructura. Niveles mas elevados de nodos establecerán sistemas de coordenadas cada vez más refinados. Finalmente las salidas finales corresponderán a las transformaciones de todas las capas anteriores, entregando una codificación del sistema de coordenadas provisto.

\begin{figure}[t]
\centering
\includegraphics[width=0.5\textwidth]{fig/grafo.png}
\caption{\textbf{Composición de funciones en forma de grafo. } GRafo de conexión entre la coordenada $(x,y)$ y la salida $z$. A cada conexión se le asigna un peso, el cual multiplica a la salida de la función del nodo entrante. Si múltiples conexiones entran a una misma función, esta recibe como entrada la suma de las salidas de cada una de las funciones entrantes multiplicadas por sus respectivos pesos de conexión. Se debe tener en cuenta que la topología no tiene restricciones y puede representar cualquier relación posible. Esta representación es similar al formalismo de las ANNs tradicionales con funciones de activación y topologías arbitrarias. Imagen adaptada de \cite{cppn}.}
\label{grafo}
\end{figure}

Es interesante observar que un grafo de dicha composición es muy similar a una ANN con topología arbitraria. La única diferencia entre ambas es que las ANNs generalmente usan funciones sigmoides (y a veces funciones Gaussianas) como función de activación de cada nodo, mientras que un grafo puede usar cualquier variedad de funciones canónicas en cada nodo.

Finalmente podemos referirnos a ``Compositional Pattern Producing Networks'' (CPPNs) para describir una composición de funciones en forma de grafo que busca reproducir patrones regulares.

\subsection{EVOLUCIÓN DE UNA RED CPPN}

Casualmente las redes CPPN y ANNs son similares desde una perspectiva estructural. Muchos métodos para evolucionar topologías y pesos de conexión en ANNs ya existen, por lo que es posible extender de manera fácil estos métodos para evolucionar una red CPPN añadiendo pequeños cambios.

Anteriormente se describió una propiedad esencial de la evolución en la naturaleza que describe la gradual complejización del genoma. La idea principal es iniciar con un pequeño genoma al cual se le añaden nuevos genes en el trascurso de la evolución. En CPPNs esto significa que se añadirán nuevas conexiones o nodos con variadas funciones de activación a la red, permitiendo así complejizarla para poder establecer regularidades fundamentales al inicio de su desarrollo para luego hacerlas más elaboradas a lo largo de la evolución.

El método a usar para evolucionar las CPPNs será ``NeuroEvolution of Augmenting Topologies'' (NEAT). NEAT es capaz de evolucionar ANNs increíblemente complejas a lo largo de generaciones, y sobrellevar los desafíos que conlleva evolucionar una gran población de redes de diversas topologías mediante el uso de marcas históricas. Ya que NEAT comienza trabajando sobre redes pequeñas y solo expande su espacio de solución cuando logra un beneficio de esta expansión, se vuelve capaz de encontrar ANNs significativamente más complejas, de forma contraria a métodos que evolucionan topologías fijas.

Gracias a la similitud que existe entre redes CPPN y ANNs es que, con pequeñas modificaciones, puede usarse NEAT como método de evolución.

\section{EVOLUCIONANDO REDES CPPN UTILIZANDO NEAT}

Esta sección explica el fundamento del método de neuroevolución NEAT, su funcionamiento, y como este puede evolucionar CPPNs.

A diferencia de muchos otros métodos para evolucionar ANNs existentes que tradicionalmente evolucionan redes con topologías fijas o generadas arbitrariamente de forma aleatoria (métodos de neuroevolución), NEAT\cite{neat} es la primera que inicia la evolución a partir de una población de pequeñas y simples redes neuronales, aumentando su complejidad a lo largo de las generaciones, destacando un comportamiento cada vez más sofisticado.

Antes de describir como extender el algoritmo NEAT para evolucionar CPPNs es necesario describir las tres ideas principales de las cuales NEAT se basa. 

\begin{enumerate}
\item Con el fin de permitir que las estructuras de las redes se vuelvan más complejas a través de las generaciones, se hace necesario un método para realizar un seguimiento de genes a lo largo de la evolución y podr así comparar individuos y establecer reglas de reproducción. NEAT soluciona este problema asignando una marca histórica única a cada nueva pieza de la estructura de la red que aparezca a través de mutaciones estructurales. La marca histórica es un número de identificación (id) asignado a cada gen correspondiente a su orden de aparición durante el curso de la evolución. Estos ids son heredados durante el entrecruzamiento sin cambios, y permitiendo a NEAT realizar entrecruzamientos de genes sin la necesidad de un costoso análisis topológico. De esta forma, genomas con diferentes estructuras o tamaños mantienen la compatibilidad a lo largo de la evolución, solucionando el problema planteado anteriormente de comparación de diferentes topologías en una población en evolución.

\item NEAT separa en especies a los individuos de una población, por lo que los organismos compiten principalmente entre miembro de su misma espacie en lugar de con toda la población. De esta manera las innovaciones topológicas en los genes son protegidas y se les da tiempo para que optimicen sus estructuras antes de competir con otras especies dentro de la población. NEAT utiliza los ids en genes para determinar a qué especies pertenecen diferentes individuos.

\item Otros sistemas que evolucionan redes con topologías con nodos interconectados con pesos o costos en sus conexiones comienzan una evolución con una población con topologías aleatorias.  NEAT al contrario, comienza con una población uniforme de redes simples sin capas intermedias, difiriendo solo en los pesos de sus conexiones inicializados aleatoriamente. Diversas topologías se acumulan gradualmente durante la evolución, lo que permite diversos y complejos patrones fenotípicos para ser representados. No está indicado un límite del tamaño que puede llegar a alcanzar una topología. Así, NEAT puede iniciar la evolución desde una estructura mínima, y aumentar su tamaño sobre un número determinado de generaciones.
\end{enumerate}

Nuevas estructuras son introducidas como sucesos de mutaciones estructurales, y solo sobrevivirán si es que resultan ser beneficiosas a través del cálculo de su desempeño. De este modo, otra ventaja de la complejización es que NEAT busca a través de soluciones dimensionalmente mas pequeñas, reduciendo significativamente el número de generaciones necesarias para encontrar la solución, y asegurando que la red no se volverá mas compleja de lo necesario. En efecto, entonces, NEAT realiza una búsqueda de una solución compacta y apropiada a través del incremento de la complejidad de estructuras ya existentes.

En base a lo descrito anteriormente, el método NEAT puede adaptarse de forma sencilla para ser implementada en una red CPPN. Este nuevo método,denominado CPPN-NEAT, es descrito a continuación.

\section{CPPN-NEAT}

CPPN-NEAT es una extensión de NEAT que permite evolucionar redes CPPN intruduciendo algunos detalles adicionales.

\begin{enumerate}
\item Mientras que redes en el método NEAT original solo incluían nodos intermedios con funciones de activación sigmoides, los nodos en CPPN-NEAT son creados asignándoles aleatoriamente una función de activación proveniente de un grupo canónico determinado de funciones (que incluye por ejemplo la función Gaussiana, Sigmoide, y funciones periódicas).

\item Además se define la función de distancia de compatibilidad para determinar si dos redes pertenecen a la misma especie, la cual incluye la información de por cuantas funciones de activación difieren dos individuos distintos. Esta característica permite que en la separación de individuos en especies se tome en cuenta el número de funciones de activación que difieren entre individuos.
\end{enumerate}

Ya que CPPN-NEAT es una mejora de un preexistente efectivo método de neuroevolución, proporciona una base fiable para el estudio de la evolución de formas cada vez mas complejas, como ANNs de gran escala u otras estructuras tipo grafo con simetrías y patrones complejos de repetición. La siguiente sección presenta un enfoque que permite a CPPN representar y evolucionar simplemente este tipo de redes.

\section{HYPERNEAT}

Si redes CPPN son evolucionadas para representar patrones de conectividad\cite{hyperneat}, el problema se dirige en encontrar la mejor interpretación de sus salidas para describir efectivamente la estructura que se intenta representar. El patrón de dos dimensiones mostrado en la figura \ref{mapfenotipo} presenta un desafío: ¿Cómo pueden patrones espaciales describir la conectividad de una red? Esta sección explica como patrones espaciales generados por CPPNs pueden mapear de manera natural patrones de conectividad de una red mientras que al mismo tiempo dan solución a problemas asignados a dicha red desde su propia dimensionalidad.

\subsection{MAPEANDO PATRONES ESPACIALES A PATRONES DE CONECTIVIDAD}

Existe un mapeao eficaz entre los patrones espaciales y de conectividad que pueden elegantemente explotar las geometrías de las estructuras. La idea principal es entregar a la entrada de una red CPPN las coordenadas de dos puntos que definan una conexión en lugar de entregar solo la posición de un único punto como se mostró en la figura \ref{mapfenotipo}. La salida de la red CPPN es interpretado como el \textit{peso} de la conexión en lugar de la intensidad de un punto. De esta formas las conexiones pueden ser definidas en términos de la ubicación de sus nodos terminales, teniendo así en cuenta la geometría de la red.

\begin{equation}
\text{CPPN}(x_{i},y_{i},x_{j},y_{j}) =
\left\{
	\begin{array}{ll}
		\rho_{i,j}  & \mbox{si } |\rho_{i,j}|  > \rho_{min} \\
		0 & \mbox{en otro caso }
	\end{array}
\right.
\label{eq:threshold}
\end{equation}

CPPN en efecto calcula una función $CPPN: \mathbb{R}^{4}\longrightarrow\mathbb{R}$ (ecuación \ref{eq:threshold}), en donde las coordenadas $(x_{i}, y_{i})$ y $(x_{j}, y_{j})$ corresponden a las posiciones de los nodos $i$ y $j$ a conectar. A partir de esta función se retorna el factor de peso $\rho_{i,j}$ de cada una de las conexiones entre cada nodo en la red. Por convención, una conexión no se realiza si la magnitud del $\rho$ resultante de la función CPPN, que puede ser positiva o negativa, se encuentra por debajo de un umbral mínimo $\rho_{min}$. Finalmente, las magnitudes de los factores de pesos por sobre este umbral, escalados entre cero y una magnitud máxima $\omega_{max}$ (definida para cada red como uno sobre el número de nodos de la capa formada por el menor número de ellos), corresponden a los pesos de las conexiones de la red (ecuación \ref{eq:scale}). De esta forma, los patrones producidos por la red CPPN pueden representar cualquier topología de red.

\begin{equation}
\omega_{i,j} = 
\left\{
	\begin{array}{ll}
		\dfrac{\omega_{max}}{1-\rho_{min}}(\omega_{i,j}-\rho_{min})  & \mbox{si } \rho_{i,j}  > \rho_{min} \\
		\dfrac{\omega_{max}}{1-\rho_{min}}(\omega_{i,j}+\rho_{min})  & \mbox{si } \rho_{i,j}  < -\rho_{min} \\
	\end{array}
\right.
\label{eq:scale}
\end{equation}

Por ejemplo, considere una malla de $5 \times 5$ nodos. A cada nodo se le asigna una coordenada correspondiente a su posición dentro de la malla (nombrada como \textsl{substrato} en la figura \ref{hyperneat}), donde la coordenada $(0,0)$ corresponde al centro de la malla. Asumiendo que estos nodos y sus posiciones son dadas \textsl{a priori}, un patrón de conectividad entre nodos en un espacio bidimensional es producido por una red CPPN que toma dos coordenadas (fuente y destino) como entrada, y que retorna como salida el peso de la conexión entre estos nodos, determinando así las conexiones potenciales en la malla. Ya que los pesos de las conexiones son de un modo una función de las posiciones de los nodos de fuente y destino, la distribución de pesos en las conexiones a lo largo de la malla exhibirá un patrón que estará en función de la distribución de los nodos en la malla.

El patrón de coordenadas producido por una red CPPN será llamado \textsl{substrato} de forma de distinguirlo verbalmente de la red CPPN misma, el cual tendrá su propia topología interna.

\begin{figure}[t]
\centering
\includegraphics[width=0.8\textwidth]{fig/hyperneat.png}
\caption{\textbf{Interpretación del patrón geométrico de conectividad de un hipercubo. } En una malla de nodos, llamada \textsl{substrato}, a cada uno de los nodos se le es asignada una coordenada tal que el nodo central se encuentra en el origen. (1) Cada conexión potencial es consultada para determinar si esta existe, y de existir, cual sería su peso; la linea negra en la parte inferior derecha del substrato indica una posible conexión a ser consultada. (2) Por cada consulta, la red CPPN toma como entrada las coordenadas de los dos puntos terminales y (3) entrega como salida el peso de la conexión entre ellos. Luego de que todas las conexiones han sido determinadas, un patrón de conexiones y pesos de conexión resultan en función de la geometría del substrato. De esta forma, la red CPPN produce patrones de regularidad de conexiones en el espacio. Imagen adaptada de \cite{cppn}.}
\label{hyperneat}
\end{figure}

Ya que la red CPPN en este caso representa una función de cuatro dimensiones, el patrón de conectividad bidimensional expresado por la red CPPN es isomorfo al patrón espacial presente en un hipercubo de cuatro dimensiones. Esta observación es importante ya que esto significa que patrones espaciales con simetrías y regularidades corresponden a patrones de conectividad también con dichas simetrías y regularidades. Así, tal como CPPNs generan patrones espaciales regulares, por extensión se puede esperar que puedan producir patrones de conectividad con las correspondientes regularidades. La siguiente sección muestra dichas capacidades.

\subsection{GENERACIÓN DE PATRONES DE CONECTIVIDAD REGULARES}

Subestructuras descubiertas en la red CPPN producen importantes regularidades en las conexiones del substrato utilizando como entradas los valores de las coordenadas de los puntos en el eje $x$ y en el eje $y$. Así por ejemplo, una simetría a lo largo del eje $x$ puede ser simplemente descubierta mediante la aplicación de una función simétrica (por ejemplo Gaussiana) a las coordenadas $x_{1}$ y $x_{2}$ (figura \ref{fig:patronsim}).

\begin{figure}[t]
	\centering
	\begin{subfigure}[b]{0.35\textwidth}
		\centering
        \includegraphics[width=0.7\textwidth]{fig/patronescppn1.png}
        \caption{Simetría}
        \label{fig:patronsim}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.35\textwidth}
    	\centering
        \includegraphics[width=0.7\textwidth]{fig/patronescppn2.png}
        \caption{Simetría Imperfecta}
        \label{fig:patronsimimp}
    \end{subfigure}
    
    \begin{subfigure}[b]{0.35\textwidth}
    	\centering
        \includegraphics[width=0.7\textwidth]{fig/patronescppn3.png}
        \caption{Repetición}
        \label{fig:patronrep}
    \end{subfigure}
    ~ 
    \begin{subfigure}[b]{0.35\textwidth}
    	\centering
        \includegraphics[width=0.7\textwidth]{fig/patronescppn4.png}
        \caption{Repetición con Variaciones}
        \label{fig:patronrepvar}
    \end{subfigure}
    \caption{\textbf{Patrones de conectividad producidos por CPPNs. } Estos patrones, producidos a través de la evolución, exhiben importantes casos de patrones de conectividad: (a) simetría bilateral, (b) simetría imperfecta, (c) repetición, y (d) repetición con variaciones. Que estos patrones sean generados fácilmente y representados de forma compacta sugiere el poder de esta codificación. Imagen adaptada de \cite{cppn}.}
    \label{fig:patronescppn}
\end{figure}

Una simetría imperfecta es otro importante patrón observado. Una red CPPN puede producir simetrías imperfectas por la composición de dos funciones simétricas junto a un marco de coordenadas asimétrico. De esta manera, la red CPPN puede producir diferentes grados de simetrías imperfectas como el ejemplo de la figura \ref{fig:patronsimimp}.

Otro patrón importante es el de repetición, particularmente el de repetición con variaciones. Tal como funciones simétricas producen simetrías, funciones periódicas, como la función seno, produce repeticiones (figura \ref{fig:patronrep}). Patrones con variaciones son producidos por una composición de una función periódica con un marco de coordenadas sin repeticiones, tal como su propio eje (figura \ref{fig:patronrepvar}). Así, simetría, simetría imperfecta, repetición y repetición con variaciones son regularidades que pueden ser representadas de forma compacta y por lo tanto fácilmente descubiertas por CPPNs.

La siguiente sección ahondará en las configuraciones que puede adoptar el substrato.

\subsection{CONFIGURACIONES DEL SUBSTRATO}

La disposición de los nodos que CPPN conecta en el substrato puede tomar otras formas distintas a la malla plana mostrada en el ejemplo demostrativo de la figura \ref{hyperneat} y en la figura \ref{fig:substrateconf1}. Configuraciones de substratos diferentes son probablemente más adecuadas para distintos tipos de problemas.

\begin{figure}[t]
	\centering
	\begin{subfigure}[b]{0.35\textwidth}
		\centering
        \includegraphics[width=0.7\textwidth]{fig/substrateconf1.png}
        \caption{Malla}
        \label{fig:substrateconf1}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.35\textwidth}
    	\centering
        \includegraphics[width=0.7\textwidth]{fig/substrateconf2.png}
        \caption{Tridimensional}
        \label{fig:substrateconf2}
    \end{subfigure}
    
    \begin{subfigure}[b]{0.35\textwidth}
    	\centering
        \includegraphics[width=0.7\textwidth]{fig/substrateconf3.png}
        \caption{Sándwich}
        \label{fig:substrateconf3}
    \end{subfigure}
    ~ 
    \begin{subfigure}[b]{0.35\textwidth}
    	\centering
        \includegraphics[width=0.7\textwidth]{fig/substrateconf4.png}
        \caption{Circular}
        \label{fig:substrateconf4}
    \end{subfigure}
    \caption{\textbf{Alternativas de configuración del Substrato. } Estas figuras muestran (b) una configuración tridimensional de nodos centrados en (0,0,0), (c) una configuración sándwich de dos capas en la cual una capa fuente de neuronas se conecta directamente a una capa destino, y (d) una configuración circular. Diferentes configuraciones son probablemente mas adecuadas para problemas con diferentes propiedades geométricas. Imagen adaptada de \cite{cppn}.}
    \label{fig:substrateconf}
\end{figure}

Por ejemplo, redes CPPN también pueden producir patrones de conectividad tridimensionales por la representación espacial de patrones de una función $CPPN: \mathbb{R}^{6}\longrightarrow\mathbb{R}$ (ecuación \ref{eq:hipercubo}) en un hipercubo de seis dimensiones (figura \ref{fig:substrateconf2}), tal como es teóricamente la topología de los cerebros biológicos.

\begin{equation}
\begin{array}{rcl}
	\mbox{CPPN}(\overrightarrow{P_{1}},\overrightarrow{P_{2}}) & = & \rho_{1,2} \\
	\overrightarrow{P_{1}} & = & (x_{1},y_{1},z_{1}) \\
	\overrightarrow{P_{2}} & = & (x_{2},y_{2},z_{2})
\end{array}
\label{eq:hipercubo}
\end{equation}

También es posible restringir configuraciones de substrato a determinadas topologías con el fin de aprender acerca de su viabilidad de forma aislada. Por ejemplo, Churchland \cite{churchuland} llama a una simple capa bidimensional de neuronas conectada a otra capa bidimensional un \textit{``state-space sandwich''}. El sándwich es una estructura tridimensional restringida en la cual una capa solo puede entablar conexiones en una sola dirección hacia otra capa. Por lo tanto, debido a esta restricción, se puede expresar por una única función $\text{CPPN}(x_{1},y_{1},x_{2},y_{2})$ de dimensión cuatro, donde $(x_{2},y_{2})$ se interpreta como una locación en la capa de destino en lugar de estar en el mismo plano de coordenadas de $(x_{1},y_{1})$. De esta manera, CPPNs pueden hacer búsqueda de patrones útiles dentro de un substrato con configuración state-space sandwich (figura \ref{fig:substrateconf3}).

Finalmente, los nodos en una capa no tienen que estar necesariamente distribuidos en forma de malla. Por ejemplo, nodos dentro de un substrato que controla entradas radiales, como por ejemplo un robot con sensores de distancia situados a su alrededor, podrían estar dispuestos mejor en un esquema con simetría radial, como se muestra en la figura \ref{fig:substrateconf4}, de modo que el patrón de conectividad se pueda establecer con un sistema de coordenadas polares perfecto.

\subsection{POSICIONAMIENTO DE ENTRADAS Y SALIDAS}

Parte de la configuración del substrato es la determinación de cuales nodos son entradas y cuales salidas. La flexibilidad de asignar entradas y salidas a coordenadas especificas en el substrato crea una oportunidad de explorar relaciones geométricas ventajosamente.

En muchas aplicaciones de ANNs, las entradas son dibujadas por un grupo de sensores en un arreglo geométrico en el espacio. A diferencia de los algoritmos tradicionales de aprendizaje de ANNs que no son conscientes de tal geometría, una red CPPN si sera consciente de ello y puede usar esa información a su favor.

Mediante la disposición de las entradas y las salidas en una configuración especifica en el substrato, regularidades en la geometría pueden ser explotadas por la codificación. Esto permite ser creativos para probar diferentes configuraciones geométricas que aporten distintas ventajas. Por ejemplo, la figura \ref{fig:posio} describe dos métodos en los cuales las entradas y las salidas de un robot circular pueden ser configuradas, en donde ambas crean una oportunidad de explotar diferentes formas de relaciones geométricas. 

\begin{figure}[t]
	\centering
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
        \includegraphics[width=\textwidth]{fig/posio1.png}
        \caption{Robot}
        \label{fig:posio1}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.3\textwidth}
    	\centering
        \includegraphics[width=\textwidth]{fig/posio2.png}
        \caption{Concéntrica}
        \label{fig:posio2}
    \end{subfigure}
    ~ 
    \begin{subfigure}[b]{0.3\textwidth}
    	\centering
        \includegraphics[width=\textwidth]{fig/posio3.png}
        \caption{Paralela}
        \label{fig:posio3}
    \end{subfigure}
    \caption{\textbf{Posicionando entradas y salidas. } Un robot (a) es descrito con ocho sensores lidar como entradas de estímulos, y ocho actuadores para respuestas motoras situados de forma radial equiangularmente distanciados. En (b), las entradas (de etiqueta \textit{I}, correspondientes a sensores lidar) y salidas (de etiqueta \textit{O}, correspondientes a actuadores) están situadas en la misma diagonal en los ocho sectores indicados en (a). En (c), entradas y salidas son situadas horizontales y paralelamente unas de la otras en dos filas. Ambos arreglos crean una relación geométrica entre cada entrada y su correspondiente salida. De esta forma es posible dar ventaja a la evolución desde el comienzo. Imagen adaptada de \cite{cppn}.}
    \label{fig:posio}
\end{figure}

En un arreglo, los sensores de la periferia del robot son situados en un circulo centrado en el origen del substrato, y las salidas forman una circunferencia concéntrica alrededor de este (figura \ref{fig:posio2}). De esta forma, si la red CPPN descubre simetrías radiales o bilaterales, esta puede usar este sistema de coordenadas para crear un patrón repetitivo que capture regularidades en las conexiones entre las entradas y las salidas. Un arreglo alternativo es situar las entradas y las salidas en dos lineas paralelas en donde la posición de cada entrada y salida esta correlacionada con el ángulo de ubicación en el robot en cada una de sus filas respectivamente (figura \ref{fig:posio3}). De esa forma, la evolución puede explotar las similitudes de las posiciones horizontales de las entradas y salidas. Ambos métodos representan correspondencia a través de una regularidad geométrica diferente.

A través del arreglo de las neuronas en una configuración especifica en el substrato, regularidades en la geometría pueden ser explotadas por la codificación. 

\subsection{RESOLUCIÓN DEL SUBSTRATO}

En contraposición con la codificación de un patrón específico de conexiones entre un conjunto específico de nodos, una red CPPN en efecto codifica un concepto de conectividad general, es decir, los fundamentos de las relaciones matemáticas producen un patrón particular. La consecuencia es que la misma red CPPN puede representar un concepto equivalente en diferentes resoluciones o densidades de nodos. La figura \ref{fig:substrateres} muestra dos conceptos de conectividad en diferentes resoluciones.

\begin{figure}[ht!]
	\centering
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
        \includegraphics[width=\textwidth]{fig/substrateres1.png}
        \caption{Concepto 1 de $5 \times 5$}
        \label{fig:substrateres1}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.3\textwidth}
    	\centering
        \includegraphics[width=\textwidth]{fig/substrateres2.png}
        \caption{Concepto 1 de $7 \times 7$}
        \label{fig:substrateres2}
    \end{subfigure}
    ~ 
    \begin{subfigure}[b]{0.3\textwidth}
    	\centering
        \includegraphics[width=\textwidth]{fig/substrateres3.png}
        \caption{Concepto 1 de CPPN}
        \label{fig:substrateres3}
    \end{subfigure}
    
    \centering
	\begin{subfigure}[b]{0.3\textwidth}
		\centering
        \includegraphics[width=\textwidth]{fig/substrateres4.png}
        \caption{Concepto 2 de $5 \times 5$}
        \label{fig:substrateres4}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.3\textwidth}
    	\centering
        \includegraphics[width=\textwidth]{fig/substrateres5.png}
        \caption{Concepto 2 de $7 \times 7$}
        \label{fig:substrateres5}
    \end{subfigure}
    ~ 
    \begin{subfigure}[b]{0.3\textwidth}
    	\centering
        \includegraphics[width=\textwidth]{fig/substrateres6.png}
        \caption{Concepto 2 de CPPN}
        \label{fig:substrateres6}
    \end{subfigure}
    \caption{\textbf{Conceptos de conectividad equivalentes en diferentes resoluciones del substrato. } Se describen dos conceptos de conectividad generados en el proceso de evolución. La red CPPN que genera el primer concepto a resoluciones de $5 \times 5$ (a) y $7 \times 7$ (b) es mostrado en (c). La red CPPN en (f) genera de forma similar el segundo concepto en ambas resoluciones (d) y (e). Esta ilustración demuestra que CPPNs representan un concepto matemático en lugar de una sola estructura. Así, la misma red CPPN puede producir patrones con el mismo fundamento conceptual en diferentes resoluciones del substrato en diferente densidad de nodos. Las funciones de activación de las redes CPPN mostradas están denotadas por \textit{G} para funciones \textit{Gaussianas}, \textit{S} para \textit{Sigmoides}, \textit{Si} para \textit{Senos}, y \textit{L} para \textit{Lineales}. Imagen adaptada de \cite{cppn}.}
    \label{fig:substrateres}
\end{figure}

Para substratos con neuronas, la importante implicancia de esto es que la misma funcionalidad de la ANN puede ser generada en distintas resoluciones. Sin más evolución, una red CPPN previamente evolucionada puede ser usada para especificar el patrón de conectividad de un mismo tipo de substrato con una resolución mayor, generando de este modo una solución para un mismo problema con una resolución mas alta.  

\subsection{EVOLUCIÓN DE LA RED CPPN}

La propuesta de este método, base para la implementación de \(\tau\)-HyperNEAT, es evolucionar una red CPPN usando NEAT para generar un patrón de conectividad en otra red principal que posee características geométricas propias del problema a solucionar. Este método base es llamado HyperNEAT ya que se usa a NEAT para evolucionar una red CPPN que busca representar patrones espaciales en un hiperespacio.

El esquema básico del algoritmo del método HyperNEAT se muestra a continuación:

\begin{enumerate}
\item Elegir una configuración de substrato, es decir, el posicionamiento de cada nodo y la asignación de nodos de entrada y salida.
\item Inicializar una población de redes CPPN con pesos asignados de forma aleatoria.
\item Repetir hasta encontrar una solución:
	\begin{enumerate}
	\item Por cada miembro de la población de redes CPPN:
		\begin{enumerate}[label=(\roman*)]
		\item Usar la red CPPN para determinar el factor de peso de cada posible conexión en el substrato. Si el valor absoluto de la salida de la red CPPN sobrepasa la magnitud de un umbral, se crea la conexión con el factor de peso dado por la salida de la red CPPN escalada apropiadamente.
		\item Se usa el substrato como una ANN en la tarea a resolver para determinar su desempeño y asignar el resultado a la red CPPN.
		\end{enumerate}
	\item Reproducir las redes CPPN acorde al método NEAT para producir una nueva población de CPPNs correspondientes a una nueva generación.
	\end{enumerate}
\end{enumerate}

En efecto, como HyperNEAT incorpora nuevas conexiones y nodos a la estructura de la red CPPN, esta esta descubriendo nuevas dimensiones globales de variaciones en los patrones de conectividad a través del substrato. Al principio es posible descubrir una simetría global, para luego descubrir un concepto mas elaborado de las regularidades del sistema. Cada nuevo nodo y conexión en el substrato representan una nueva manera en que un patrón a generar pueda variar dándose nuevas regularidades. Así, HyperNEAT es una propuesta para evolucionar patrones de conectividad a gran escala en ANNs.